{
  "description": "Adafruit Motor Shield V1 communication. The old one based on two L293D and 74HC595 chip. Cloned by many vendors.",
  "license": "AGPL-3",
  "name": "af-motor",
  "patches": {
    "@/dc-example": {
      "comments": {
        "SkwcmI-Gf": {
          "content": "Connect pots to A0, A1, A2, A3. Each of them controls a motor on corresponding channel.",
          "id": "SkwcmI-Gf",
          "position": {
            "x": 408,
            "y": -102
          },
          "size": {
            "height": 153,
            "width": 136
          }
        }
      },
      "description": "`dc-motors` node usage example",
      "links": {
        "B1PJA7ZzM": {
          "id": "B1PJA7ZzM",
          "input": {
            "nodeId": "rJB1R7ZMG",
            "pinKey": "HkXK-dGob"
          },
          "output": {
            "nodeId": "HkSJLQWGM",
            "pinKey": "H1sM2A12-"
          }
        },
        "BkFgRm-MM": {
          "id": "BkFgRm-MM",
          "input": {
            "nodeId": "rJXeCQWff",
            "pinKey": "HkXK-dGob"
          },
          "output": {
            "nodeId": "rkoJUXWzf",
            "pinKey": "H1sM2A12-"
          }
        },
        "ByDeA7bzz": {
          "id": "ByDeA7bzz",
          "input": {
            "nodeId": "rkWxAQWzf",
            "pinKey": "HkXK-dGob"
          },
          "output": {
            "nodeId": "HJl91LQ-GM",
            "pinKey": "H1sM2A12-"
          }
        },
        "SJDxL7bGG": {
          "id": "SJDxL7bGG",
          "input": {
            "nodeId": "rkWJImbMM",
            "pinKey": "Hked977-zz"
          },
          "output": {
            "nodeId": "rkoJUXWzf",
            "pinKey": "H1sM2A12-"
          }
        },
        "SJOJLXWGM": {
          "id": "SJOJLXWGM",
          "input": {
            "nodeId": "rkWJImbMM",
            "pinKey": "BJB57Xbzf"
          },
          "output": {
            "nodeId": "HkSJLQWGM",
            "pinKey": "H1sM2A12-"
          }
        },
        "SyUxL7Zzz": {
          "id": "SyUxL7Zzz",
          "input": {
            "nodeId": "rkWJImbMM",
            "pinKey": "By_qXmbfM"
          },
          "output": {
            "nodeId": "HJl91LQ-GM",
            "pinKey": "H1sM2A12-"
          }
        },
        "r1LeA7WzM": {
          "id": "r1LeA7WzM",
          "input": {
            "nodeId": "rk1xRmWzf",
            "pinKey": "HkXK-dGob"
          },
          "output": {
            "nodeId": "B151UQbMM",
            "pinKey": "H1sM2A12-"
          }
        },
        "rJEgIXbzG": {
          "id": "rJEgIXbzG",
          "input": {
            "nodeId": "rkWJImbMM",
            "pinKey": "B1DcmXbfG"
          },
          "output": {
            "nodeId": "B151UQbMM",
            "pinKey": "H1sM2A12-"
          }
        }
      },
      "nodes": {
        "B151UQbMM": {
          "boundValues": {
            "Hkry2AJhW": 1
          },
          "id": "B151UQbMM",
          "position": {
            "x": 170,
            "y": 0
          },
          "type": "xod/common-hardware/pot"
        },
        "HJl91LQ-GM": {
          "boundValues": {
            "Hkry2AJhW": 2
          },
          "id": "HJl91LQ-GM",
          "position": {
            "x": 204,
            "y": 102
          },
          "type": "xod/common-hardware/pot"
        },
        "HkSJLQWGM": {
          "id": "HkSJLQWGM",
          "position": {
            "x": 136,
            "y": -102
          },
          "type": "xod/common-hardware/pot"
        },
        "rJB1R7ZMG": {
          "id": "rJB1R7ZMG",
          "position": {
            "x": 238,
            "y": -102
          },
          "type": "xod/core/watch"
        },
        "rJXeCQWff": {
          "id": "rJXeCQWff",
          "position": {
            "x": 340,
            "y": 204
          },
          "type": "xod/core/watch"
        },
        "rk1xRmWzf": {
          "id": "rk1xRmWzf",
          "position": {
            "x": 272,
            "y": 0
          },
          "type": "xod/core/watch"
        },
        "rkWJImbMM": {
          "id": "rkWJImbMM",
          "position": {
            "x": 136,
            "y": 306
          },
          "type": "@/dc-motors"
        },
        "rkWxAQWzf": {
          "id": "rkWxAQWzf",
          "position": {
            "x": 306,
            "y": 102
          },
          "type": "xod/core/watch"
        },
        "rkoJUXWzf": {
          "boundValues": {
            "Hkry2AJhW": 3
          },
          "id": "rkoJUXWzf",
          "position": {
            "x": 238,
            "y": 204
          },
          "type": "xod/common-hardware/pot"
        }
      },
      "path": "@/dc-example"
    },
    "@/dc-motors": {
      "attachments": [
        {
          "content": "\nstruct State {\n    bool begun;\n};\n\n{{ GENERATED_CODE }}\n\n\n// Derive pinout from schematic\n// https://cdn-learn.adafruit.com/assets/assets/000/009/769/original/mshieldv1-schem.png\n\nconstexpr uint8_t DIR_LATCH = 12;\nconstexpr uint8_t DIR_SER = 8;\nconstexpr uint8_t DIR_CLK = 4;\nconstexpr uint8_t DIR_EN = 7;\n\nconstexpr uint8_t M1_PWM = 11; // PMW2A\nconstexpr uint8_t M1_A = 1 << 2;\nconstexpr uint8_t M1_B = 1 << 3;\n\nconstexpr uint8_t M2_PWM = 3; // PMW2B\nconstexpr uint8_t M2_A = 1 << 1;\nconstexpr uint8_t M2_B = 1 << 4;\n\nconstexpr uint8_t M3_PWM = 5; // PMW0B\nconstexpr uint8_t M3_A = 1 << 0;\nconstexpr uint8_t M3_B = 1 << 6;\n\nconstexpr uint8_t M4_PWM = 6; // PMW0A\nconstexpr uint8_t M4_A = 1 << 5;\nconstexpr uint8_t M4_B = 1 << 7;\n\n\nvoid evaluate(Context ctx) {\n    State* state = getState(ctx);\n    if (!state->begun) {\n        pinMode(DIR_LATCH, OUTPUT);\n        pinMode(DIR_SER, OUTPUT);\n        pinMode(DIR_CLK, OUTPUT);\n        pinMode(DIR_EN, OUTPUT);\n        pinMode(M1_PWM, OUTPUT);\n        pinMode(M1_A, OUTPUT);\n        pinMode(M1_B, OUTPUT);\n        pinMode(M2_PWM, OUTPUT);\n        pinMode(M2_A, OUTPUT);\n        pinMode(M2_B, OUTPUT);\n        pinMode(M3_PWM, OUTPUT);\n        pinMode(M3_A, OUTPUT);\n        pinMode(M3_B, OUTPUT);\n        pinMode(M4_PWM, OUTPUT);\n        pinMode(M4_A, OUTPUT);\n        pinMode(M4_B, OUTPUT);\n\n        state->begun = true;\n    }\n    \n    Number m1Speed = getValue<input_M1>(ctx);\n    Number m2Speed = getValue<input_M2>(ctx);\n    Number m3Speed = getValue<input_M3>(ctx);\n    Number m4Speed = getValue<input_M4>(ctx);\n    \n    // Send direction data to L293s through 74HC595\n    uint8_t dirByte =\n        (m1Speed < 0 ? M1_A : M1_B) |\n        (m2Speed < 0 ? M2_A : M2_B) |\n        (m3Speed < 0 ? M3_A : M3_B) |\n        (m4Speed < 0 ? M4_A : M4_B);\n    \n    digitalWrite(DIR_LATCH, LOW);\n    shiftOut(DIR_SER, DIR_CLK, MSBFIRST, dirByte);\n    digitalWrite(DIR_LATCH, HIGH);\n    \n    // Adjust EN’s of L293s\n    analogWrite(M1_PWM, abs(m1Speed) * 255);\n    analogWrite(M2_PWM, abs(m2Speed) * 255);\n    analogWrite(M3_PWM, abs(m3Speed) * 255);\n    analogWrite(M4_PWM, abs(m4Speed) * 255);\n}\n",
          "encoding": "utf8",
          "filename": "patch.cpp"
        }
      ],
      "description": "Drives DC motors on all four shield channels.",
      "nodes": {
        "B1DcmXbfG": {
          "description": "Speed of motor at channel `M2` in range [-1, 1]",
          "id": "B1DcmXbfG",
          "label": "M2",
          "position": {
            "x": 68,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "BJB57Xbzf": {
          "description": "Speed of motor at channel `M1` in range [-1, 1]",
          "id": "BJB57Xbzf",
          "label": "M1",
          "position": {
            "x": 34,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "By_qXmbfM": {
          "description": "Speed of motor at channel `M3` in range [-1, 1]",
          "id": "By_qXmbfM",
          "label": "M3",
          "position": {
            "x": 102,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "Hked977-zz": {
          "description": "Speed of motor at channel `M4` in range [-1, 1]",
          "id": "Hked977-zz",
          "label": "M4",
          "position": {
            "x": 136,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "ryQ2mmbzM": {
          "id": "ryQ2mmbzM",
          "position": {
            "x": 34,
            "y": 102
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        }
      },
      "path": "@/dc-motors"
    },
    "@/servo-1": {
      "nodes": {
        "Hyc2x9X7G": {
          "id": "Hyc2x9X7G",
          "type": "xod/common-hardware/servo",
          "position": {
            "x": 102,
            "y": 204
          },
          "boundValues": {
            "S1vGmu6Gb": 10
          }
        },
        "HyMplcm7M": {
          "id": "HyMplcm7M",
          "type": "xod/patch-nodes/input-number",
          "position": {
            "x": 136,
            "y": 102
          },
          "label": "VAL",
          "description": "Desired servo angle or value in unit range [0.0, 1.0]. For standard servo 0.0 would be mapped to 0° and 1.0 would be 180°."
        }
      },
      "links": {
        "H14ae5mmG": {
          "id": "H14ae5mmG",
          "output": {
            "nodeId": "HyMplcm7M",
            "pinKey": "__out__"
          },
          "input": {
            "nodeId": "Hyc2x9X7G",
            "pinKey": "r1sfQ_6fb"
          }
        }
      },
      "path": "@/servo-1",
      "description": "Drives a standard hobby servo connected through the SERVO_1 connector on Adafruit Motor Shield."
    },
    "@/servo-2": {
      "nodes": {
        "Sk_qZqQQf": {
          "id": "Sk_qZqQQf",
          "type": "xod/common-hardware/servo",
          "position": {
            "x": -1,
            "y": 101
          },
          "boundValues": {
            "S1vGmu6Gb": 9
          }
        },
        "r1ldqZ5QXf": {
          "id": "r1ldqZ5QXf",
          "type": "xod/patch-nodes/input-number",
          "position": {
            "x": 33,
            "y": -1
          },
          "label": "VAL",
          "description": "Desired servo angle or value in unit range [0.0, 1.0]. For standard servo 0.0 would be mapped to 0° and 1.0 would be 180°."
        }
      },
      "links": {
        "rybuc-57XG": {
          "id": "rybuc-57XG",
          "output": {
            "nodeId": "r1ldqZ5QXf",
            "pinKey": "__out__"
          },
          "input": {
            "nodeId": "Sk_qZqQQf",
            "pinKey": "r1sfQ_6fb"
          }
        }
      },
      "path": "@/servo-2",
      "description": "Drives a standard hobby servo connected through the SERVO_2 connector on Adafruit Motor Shield."
    },
    "@/servo-example": {
      "nodes": {
        "H1K0bqXmG": {
          "id": "H1K0bqXmG",
          "type": "xod/common-hardware/pot",
          "position": {
            "x": 68,
            "y": 0
          }
        },
        "ryAAW9Xmf": {
          "id": "ryAAW9Xmf",
          "type": "@/servo-1",
          "position": {
            "x": 68,
            "y": 204
          }
        },
        "HytLMqmQf": {
          "id": "HytLMqmQf",
          "type": "@/servo-2",
          "position": {
            "x": 102,
            "y": 204
          }
        }
      },
      "links": {
        "H1Q1fqQ7G": {
          "id": "H1Q1fqQ7G",
          "output": {
            "nodeId": "H1K0bqXmG",
            "pinKey": "H1sM2A12-"
          },
          "input": {
            "nodeId": "ryAAW9Xmf",
            "pinKey": "HyMplcm7M"
          }
        },
        "BJiLMcXQf": {
          "id": "BJiLMcXQf",
          "output": {
            "nodeId": "H1K0bqXmG",
            "pinKey": "H1sM2A12-"
          },
          "input": {
            "nodeId": "HytLMqmQf",
            "pinKey": "r1ldqZ5QXf"
          }
        }
      },
      "path": "@/servo-example",
      "description": "`servo-1` and `servo-2` usage example"
    }
  },
  "version": "1.1.0"
}
