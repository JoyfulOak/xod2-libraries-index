{
  "description": "Allows an Arduino board with USB capabilites to act as a MIDI instrument over USB.\nA wrapper around https://github.com/arduino-libraries/MIDIUSB",
  "license": "GPLv3",
  "name": "usb-midi",
  "patches": {
    "@/receive(usb-midi)": {
      "attachments": [
        {
          "content": "node {\n    void evaluate(Context ctx) {\n        if (!isInputDirty<input_RCV>(ctx)) return;\n\n        auto MIDI = getValue<input_MIDI>(ctx);\n\n        auto rx = MIDI->read();\n\n        if (rx.header != 0) {\n            typeof_MSG msg = {};\n            msg.type = rx.header << 4;\n            msg.channel = rx.byte1 & 0b00001111;\n            msg.data1 = rx.byte2;\n            msg.data2 = rx.byte3;\n\n            emitValue<output_MSG>(ctx, msg);\n            emitValue<output_DONE>(ctx, 1);\n        }\n    }\n}\n",
          "encoding": "utf8",
          "filename": "patch.cpp"
        }
      ],
      "nodes": {
        "Bycv3X2CE": {
          "id": "Bycv3X2CE",
          "label": "DONE",
          "position": {
            "x": 2,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/patch-nodes/output-pulse"
        },
        "SJLLvU6A4": {
          "id": "SJLLvU6A4",
          "label": "MSG",
          "position": {
            "x": 0,
            "y": 2,
            "units": "slots"
          },
          "type": "e/midi/output-message"
        },
        "r1zO2Q2CV": {
          "id": "r1zO2Q2CV",
          "label": "MIDI",
          "position": {
            "x": 0,
            "y": 0,
            "units": "slots"
          },
          "type": "@/input-usb-midi"
        },
        "rJlqPn73A4": {
          "id": "rJlqPn73A4",
          "position": {
            "x": 0,
            "y": 1,
            "units": "slots"
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        },
        "rymcPhX2A4": {
          "boundLiterals": {
            "__out__": "Continuously"
          },
          "id": "rymcPhX2A4",
          "label": "RCV",
          "position": {
            "x": 2,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-pulse"
        }
      },
      "path": "@/receive(usb-midi)"
    },
    "@/send(usb-midi)": {
      "attachments": [
        {
          "content": "node {\n    void evaluate(Context ctx) {\n        if (!isInputDirty<input_SEND>(ctx)) return;\n\n        auto MIDI = getValue<input_MIDI>(ctx);\n        auto msg = getValue<input_MSG>(ctx);\n\n        uint8_t data[4];\n        data[0] = msg.type >> 4;\n        data[1] = msg.type | msg.channel;\n        data[2] = msg.data1;\n        data[3] = msg.data2;\n\n        MIDI->write(data, 4);\n        MIDI->flush();\n\n        emitValue<output_DONE>(ctx, 1);\n    }\n}\n",
          "encoding": "utf8",
          "filename": "patch.cpp"
        }
      ],
      "nodes": {
        "Bk9B5sKC4": {
          "id": "Bk9B5sKC4",
          "label": "MIDI",
          "position": {
            "x": 0,
            "y": 0,
            "units": "slots"
          },
          "type": "@/input-usb-midi"
        },
        "BkZ_PUTAV": {
          "id": "BkZ_PUTAV",
          "label": "MSG",
          "position": {
            "x": 3,
            "y": 0,
            "units": "slots"
          },
          "type": "e/midi/input-message"
        },
        "SyWtNqoK0E": {
          "id": "SyWtNqoK0E",
          "label": "DONE",
          "position": {
            "x": 0,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/patch-nodes/output-pulse"
        },
        "SyfKE5iF0N": {
          "id": "SyfKE5iF0N",
          "label": "SEND",
          "position": {
            "x": 6,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "rymYVqoYCE": {
          "id": "rymYVqoYCE",
          "position": {
            "x": 0,
            "y": 1,
            "units": "slots"
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        }
      },
      "path": "@/send(usb-midi)"
    },
    "@/usb-midi": {
      "attachments": [
        {
          "content": "#pragma XOD require \"https://github.com/arduino-libraries/MIDIUSB\"\n\n#include <MIDIUSB.h>\n\nnode {\n    meta {\n        using Type = MIDI_*;\n    }\n\n    void evaluate(Context ctx) {\n        emitValue<output_MIDI>(ctx, &MidiUSB);\n    }\n}\n",
          "encoding": "utf8",
          "filename": "patch.cpp"
        }
      ],
      "nodes": {
        "B1XeFoKCE": {
          "id": "B1XeFoKCE",
          "label": "MIDI",
          "position": {
            "x": 2,
            "y": 3,
            "units": "slots"
          },
          "type": "xod/patch-nodes/output-self"
        },
        "r1a1FsFRV": {
          "id": "r1a1FsFRV",
          "position": {
            "x": 2,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        }
      },
      "path": "@/usb-midi"
    }
  },
  "version": "0.1.0"
}
