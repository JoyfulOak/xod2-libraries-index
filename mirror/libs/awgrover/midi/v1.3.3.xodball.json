{
  "description": "MIDI nodes: Note, CC, Prog Change. Needs more install: https://github.com/awgrover/xod_lib/blob/master/README.md#user-content-awgrovermidi. Please give feedback on https://forum.xod.io or https://github.com/awgrover/xod_lib",
  "license": "gplv3",
  "name": "midi",
  "patches": {
    "@/bank-program-change": {
      "comments": {
        "BJHywu6fG": {
          "content": "CC is defined as 0 then 32 for bank change",
          "id": "BJHywu6fG",
          "position": {
            "x": 272,
            "y": 204
          },
          "size": {
            "height": 51,
            "width": 136
          }
        }
      },
      "description": "Bank-Select and Program-Change",
      "links": {
        "B1rcx8jbM": {
          "id": "B1rcx8jbM",
          "input": {
            "nodeId": "S1jJJUsZz",
            "pinKey": "HyVupSsWf"
          },
          "output": {
            "nodeId": "H1Kz0Bs-M",
            "pinKey": "r1DdJUj-G"
          }
        },
        "BJYix8jWf": {
          "id": "BJYix8jWf",
          "input": {
            "nodeId": "rkpcxUsbz",
            "pinKey": "__in__"
          },
          "output": {
            "nodeId": "S1jJJUsZz",
            "pinKey": "rkKOlIsWf"
          }
        },
        "BkX5g8oZM": {
          "id": "BkX5g8oZM",
          "input": {
            "nodeId": "H1Kz0Bs-M",
            "pinKey": "HJe1S4oZM"
          },
          "output": {
            "nodeId": "BJSMCBs-f",
            "pinKey": "r1DdJUj-G"
          }
        },
        "ByH7CHiZG": {
          "id": "ByH7CHiZG",
          "input": {
            "nodeId": "BJSMCBs-f",
            "pinKey": "HJe1S4oZM"
          },
          "output": {
            "nodeId": "S1b7CHjbf",
            "pinKey": "__out__"
          }
        },
        "S1-UCrjbf": {
          "id": "S1-UCrjbf",
          "input": {
            "nodeId": "H1Kz0Bs-M",
            "pinKey": "S19ESVs-M"
          },
          "output": {
            "nodeId": "BkIBCBi-M",
            "pinKey": "__out__"
          }
        },
        "SJYq0BjZf": {
          "id": "SJYq0BjZf",
          "input": {
            "nodeId": "H1Kz0Bs-M",
            "pinKey": "H1eNr4oWM"
          },
          "output": {
            "nodeId": "Bk89CrsbG",
            "pinKey": "__out__"
          }
        },
        "r1yL0Sibf": {
          "id": "r1yL0Sibf",
          "input": {
            "nodeId": "BJSMCBs-f",
            "pinKey": "S19ESVs-M"
          },
          "output": {
            "nodeId": "BkIBCBi-M",
            "pinKey": "__out__"
          }
        },
        "rJkgyUibz": {
          "id": "rJkgyUibz",
          "input": {
            "nodeId": "S1jJJUsZz",
            "pinKey": "rJ5FtBoZG"
          },
          "output": {
            "nodeId": "BkIBCBi-M",
            "pinKey": "__out__"
          }
        },
        "rJxcArsZM": {
          "id": "rJxcArsZM",
          "input": {
            "nodeId": "BJSMCBs-f",
            "pinKey": "H1eNr4oWM"
          },
          "output": {
            "nodeId": "Skw_AHi-M",
            "pinKey": "__out__"
          }
        },
        "rySX18iZG": {
          "id": "rySX18iZG",
          "input": {
            "nodeId": "S1jJJUsZz",
            "pinKey": "HJT7tBobG"
          },
          "output": {
            "nodeId": "BJveJLiZG",
            "pinKey": "__out__"
          }
        }
      },
      "nodes": {
        "BJSMCBs-f": {
          "boundValues": {
            "BJ3-BVjWG": 0
          },
          "description": "cc-0,msb bank-select",
          "id": "BJSMCBs-f",
          "position": {
            "x": 102,
            "y": 204
          },
          "type": "@/control-change"
        },
        "BJveJLiZG": {
          "boundValues": {
            "__out__": 1
          },
          "description": "Progrm Change Number",
          "id": "BJveJLiZG",
          "label": "Prg#",
          "position": {
            "x": -34,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "Bk89CrsbG": {
          "description": "LSB for bank select",
          "id": "Bk89CrsbG",
          "label": "LSB",
          "position": {
            "x": 102,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "BkIBCBi-M": {
          "boundValues": {
            "__out__": 1
          },
          "description": "MIDI Channel",
          "id": "BkIBCBi-M",
          "label": "Ch",
          "position": {
            "x": 170,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "H1Kz0Bs-M": {
          "boundValues": {
            "BJ3-BVjWG": 32
          },
          "description": "cc-32,lsb bank-select",
          "id": "H1Kz0Bs-M",
          "position": {
            "x": 102,
            "y": 408
          },
          "type": "@/control-change"
        },
        "S1b7CHjbf": {
          "description": "Send when triggered",
          "id": "S1b7CHjbf",
          "label": "send",
          "position": {
            "x": 238,
            "y": 0
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "S1jJJUsZz": {
          "id": "S1jJJUsZz",
          "position": {
            "x": 136,
            "y": 612
          },
          "type": "@/program-change"
        },
        "Skw_AHi-M": {
          "description": "MSB for bank select",
          "id": "Skw_AHi-M",
          "label": "MSB",
          "position": {
            "x": 34,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "rkpcxUsbz": {
          "description": "Pulse when sent",
          "id": "rkpcxUsbz",
          "label": "sent",
          "position": {
            "x": 136,
            "y": 714
          },
          "type": "xod/patch-nodes/output-pulse"
        }
      },
      "path": "@/bank-program-change"
    },
    "@/control-change": {
      "attachments": [
        {
          "content": "{{#global}}\n#include <MIDI.h>\nnamespace xod {\nnamespace awgrover__midi {\n  #ifndef MIDI47_DEFAULT_INSTANCE\n    // create one 'MIDI' object only once\n    #define MIDI47_DEFAULT_INSTANCE\n    bool MIDI_DefaultInited=0; // control setup once\n\n    MIDI_CREATE_DEFAULT_INSTANCE(); // MIDI\n\n    #define DEBUG_SendText(body) /* nothing, see the \"debug\" node */\n\n    void midi_setup() {\n      // this should be in setup\n      // ( call as xod::awgrover__midi::midi_setup(); in evaluate)\n      if (!MIDI_DefaultInited) {\n        // this will reset the serial port to 31250 for the midi's serial port\n        MIDI.begin(MIDI_CHANNEL_OMNI); // Enable Soft Thru, everything at the input is sent back\n        MIDI_DefaultInited = 1;\n        DEBUG_SendText( Serial.print(millis());Serial.println(F(\" MIDI.begin()\")); )\n      }\n    }\n  #endif\n}}\n{{/global}}\n\nstruct State {\n};\n\n{{ GENERATED_CODE }}\n\nvoid evaluate(Context ctx) {\n    xod::awgrover__midi::midi_setup();\n    \n    if (isInputDirty<input_send>(ctx)) {\n      auto channel = getValue<input_Ch>(ctx);\n      auto controller_number = getValue<input_CC>(ctx);\n      auto control_value = getValue<input_Val>(ctx);\n    \t// note, velocity, channel\n    \txod::awgrover__midi::MIDI.sendControlChange(controller_number, control_value, channel);\n      emitValue<output_sent>(ctx,1);\n      // only if xod \"Debugger\" is on\n      DEBUG_SendText(\n        Serial.print(millis());Serial.print(F(\" \"));\n        Serial.print(F(\"Sent CC/\"));Serial.print(channel);\n        Serial.print(F(\" \"));Serial.print(controller_number);\n        Serial.print(F(\" V \"));Serial.println(control_value);\n      )\n    }\n}\n",
          "encoding": "utf8",
          "filename": "patch.cpp"
        }
      ],
      "description": "Set the inputs, send the control change on pulse (\"send\").",
      "nodes": {
        "BJ3-BVjWG": {
          "boundValues": {
            "__out__": 3
          },
          "description": "Controller Number",
          "id": "BJ3-BVjWG",
          "label": "CC",
          "position": {
            "x": 34,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "H1eNr4oWM": {
          "description": "Controller Value",
          "id": "H1eNr4oWM",
          "label": "Val",
          "position": {
            "x": 102,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "HJXTNNibM": {
          "id": "HJXTNNibM",
          "position": {
            "x": 102,
            "y": 102
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        },
        "HJe1S4oZM": {
          "description": "Send when triggered",
          "id": "HJe1S4oZM",
          "label": "send",
          "position": {
            "x": 238,
            "y": 0
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "S19ESVs-M": {
          "boundValues": {
            "__out__": 1
          },
          "description": "MIDI Channel",
          "id": "S19ESVs-M",
          "label": "Ch",
          "position": {
            "x": 170,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "r1DdJUj-G": {
          "description": "pulse when sent",
          "id": "r1DdJUj-G",
          "label": "sent",
          "position": {
            "x": 102,
            "y": 204
          },
          "type": "xod/patch-nodes/output-pulse"
        }
      },
      "path": "@/control-change"
    },
    "@/debug": {
      "attachments": [
        {
          "content": "{{#global}}\n#include <MIDI.h>\nnamespace xod {\nnamespace awgrover__midi {\n  #ifndef MIDI47_DEFAULT_INSTANCE\n    // create one 'MIDI' object only once\n    #define MIDI47_DEFAULT_INSTANCE\n    bool MIDI_DefaultInited=0; // control setup once\n\n    struct DebugSettings : public midi::DefaultSettings {\n        static const long BaudRate = 115200;\n    };\n    MIDI_CREATE_CUSTOM_INSTANCE(HardwareSerial, Serial, MIDI, DebugSettings);\n\n    #define DEBUG_SendText(body) /* DEBUG_SendText( Serial.print.....; ... ) */ \\\n      { \\\n      /* It's a hack! universal system-exclusive 0x7E:0x00 \"unused\" */ \\\n      Serial.write(0xf0); Serial.write(0x7E); Serial.write(0x00); \\\n      body \\\n      Serial.write(0xF7); \\\n      }\n\n    void midi_setup() {\n      // this should be in setup\n      // ( call as xod::awgrover__midi::midi_setup(); in evaluate)\n      if (!MIDI_DefaultInited) {\n        MIDI.begin(MIDI_CHANNEL_OMNI); // Enable Soft Thru, everything at the input is sent back\n        MIDI_DefaultInited = 1;\n        DEBUG_SendText( Serial.print(millis());Serial.println(F(\" MIDI.begin 115200\")); )\n      }\n    }\n\n  #endif\n}}\n{{/global}}\n\n\nstruct State {\n};\n\n{{ GENERATED_CODE }}\n\nvoid evaluate(Context ctx) {\n    xod::awgrover__midi::midi_setup();\n    DEBUG_SendText( Serial.println(F(\"Config MIDI fired\")); )\n}\n",
          "encoding": "utf8",
          "filename": "patch.cpp"
        }
      ],
      "comments": {
        "SJb_I0xrG": {
          "content": "Turns on hackish debugging:\nLet's me monitor the midi messages on the usb-serial port on linux.\n\nSome debug messages are generated and sent as:\nuniversal system-exclusive 0x7E:0x00 \"unused\"\nblocks of text.\n\nAs well, the baud rate is set to 115200 because the midi-baud rate (31250) is unusual, and annoying on linux. That will almost certainly break any other MIDI device/software.\n",
          "id": "SJb_I0xrG",
          "position": {
            "x": 204,
            "y": 102
          },
          "size": {
            "height": 153,
            "width": 544
          }
        }
      },
      "description": "For this to work, it must fire first. Putting in the top-left helps. Sets baud to 115200 for debugging",
      "nodes": {
        "HyACJAMzG": {
          "boundValues": {
            "__out__": "ON_BOOT"
          },
          "id": "HyACJAMzG",
          "label": "dumy",
          "position": {
            "x": 68,
            "y": 102
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "S183KZMMM": {
          "id": "S183KZMMM",
          "position": {
            "x": 68,
            "y": 204
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        }
      },
      "path": "@/debug"
    },
    "@/example-compile-test": {
      "comments": {
        "SkgTo6eHM": {
          "content": "Not a useful patch or example.\nThis is for testing compilation of node.\nSo, it should have all the nodes",
          "id": "SkgTo6eHM",
          "position": {
            "x": 136,
            "y": 0
          },
          "size": {
            "height": 51,
            "width": 306
          }
        }
      },
      "nodes": {
        "HJj5i6lrM": {
          "id": "HJj5i6lrM",
          "position": {
            "x": 136,
            "y": 102
          },
          "type": "@/debug"
        },
        "S1pWhTlSf": {
          "id": "S1pWhTlSf",
          "position": {
            "x": 476,
            "y": 306
          },
          "type": "@/note-button"
        },
        "Sy-WnpgBz": {
          "id": "Sy-WnpgBz",
          "position": {
            "x": 476,
            "y": 102
          },
          "type": "@/bank-program-change"
        },
        "Sy4W36lrM": {
          "id": "Sy4W36lrM",
          "position": {
            "x": 476,
            "y": 204
          },
          "type": "@/control-change"
        },
        "SyA_j6lrG": {
          "id": "SyA_j6lrG",
          "position": {
            "x": 136,
            "y": 306
          },
          "type": "@/note"
        },
        "rkQKjTgrM": {
          "id": "rkQKjTgrM",
          "position": {
            "x": 136,
            "y": 204
          },
          "type": "@/control-change"
        }
      },
      "path": "@/example-compile-test"
    },
    "@/example-control-change": {
      "comments": {
        "H1Rm8EiZz": {
          "content": "On button-press, send a control change",
          "id": "H1Rm8EiZz",
          "position": {
            "x": 204,
            "y": 0
          },
          "size": {
            "height": 51,
            "width": 136
          }
        },
        "Hy4ffSiWG": {
          "content": "Every second, switch to mono,\nthen .33 sec later, back to poly",
          "id": "Hy4ffSiWG",
          "position": {
            "x": 748,
            "y": 204
          },
          "size": {
            "height": 51,
            "width": 272
          }
        },
        "rJoJZBiZG": {
          "content": "What should the defaults be?\ncontroller-number: 3 (undef?)\ncontroller-value:?\nchannel: 1,",
          "id": "rJoJZBiZG",
          "position": {
            "x": 170,
            "y": 204
          },
          "size": {
            "height": 153,
            "width": 272
          }
        }
      },
      "description": "Real simple examples",
      "links": {
        "B1HwWBsbf": {
          "id": "B1HwWBsbf",
          "input": {
            "nodeId": "SJhIWrsbM",
            "pinKey": "SkSuD6LMb"
          },
          "output": {
            "nodeId": "S1rI-Bsbf",
            "pinKey": "HJU8CE2lW"
          }
        },
        "ByCpxBj-z": {
          "id": "ByCpxBj-z",
          "input": {
            "nodeId": "HJh2SNsWG",
            "pinKey": "H1eNr4oWM"
          },
          "output": {
            "nodeId": "BkqplSjbz",
            "pinKey": "B1x2RV3eZ"
          }
        },
        "HJ618NjbM": {
          "id": "HJ618NjbM",
          "input": {
            "nodeId": "HJh2SNsWG",
            "pinKey": "HJe1S4oZM"
          },
          "output": {
            "nodeId": "ByFyLEoWM",
            "pinKey": "__out__"
          }
        },
        "HJg2-rsWM": {
          "id": "HJg2-rsWM",
          "input": {
            "nodeId": "rynuWBs-z",
            "pinKey": "HJe1S4oZM"
          },
          "output": {
            "nodeId": "S1rI-Bsbf",
            "pinKey": "HJU8CE2lW"
          }
        },
        "HkF2lrsWf": {
          "id": "HkF2lrsWf",
          "input": {
            "nodeId": "HJh2SNsWG",
            "pinKey": "BJ3-BVjWG"
          },
          "output": {
            "nodeId": "rkpjlBs-z",
            "pinKey": "B1x2RV3eZ"
          }
        },
        "SyiJGSiZz": {
          "id": "SyiJGSiZz",
          "input": {
            "nodeId": "r1FTWribf",
            "pinKey": "HJe1S4oZM"
          },
          "output": {
            "nodeId": "SJhIWrsbM",
            "pinKey": "Bk4gU0drwJ-"
          }
        },
        "ry3J8NobG": {
          "id": "ry3J8NobG",
          "input": {
            "nodeId": "ByFyLEoWM",
            "pinKey": "__in__"
          },
          "output": {
            "nodeId": "Syh6HVsWf",
            "pinKey": "BJ--G1tI-"
          }
        }
      },
      "nodes": {
        "BkqplSjbz": {
          "boundValues": {
            "B1x2RV3eZ": 2
          },
          "id": "BkqplSjbz",
          "label": "2",
          "position": {
            "x": 68,
            "y": 102
          },
          "type": "xod/core/constant-number"
        },
        "ByFyLEoWM": {
          "id": "ByFyLEoWM",
          "position": {
            "x": 136,
            "y": 102
          },
          "type": "xod/core/cast-boolean-to-pulse"
        },
        "HJh2SNsWG": {
          "id": "HJh2SNsWG",
          "position": {
            "x": 34,
            "y": 204
          },
          "type": "@/control-change"
        },
        "S1rI-Bsbf": {
          "id": "S1rI-Bsbf",
          "label": "clock 1Hz",
          "position": {
            "x": 578,
            "y": 0
          },
          "type": "xod/core/clock"
        },
        "SJhIWrsbM": {
          "boundValues": {
            "Skre8ROSv1-": 0.33
          },
          "id": "SJhIWrsbM",
          "label": "delay .33",
          "position": {
            "x": 646,
            "y": 102
          },
          "type": "xod/core/delay"
        },
        "Syh6HVsWf": {
          "boundValues": {
            "ByNiWkt8Z": 10
          },
          "id": "Syh6HVsWf",
          "position": {
            "x": 136,
            "y": 0
          },
          "type": "xod/common-hardware/button"
        },
        "r1FTWribf": {
          "boundValues": {
            "BJ3-BVjWG": 127
          },
          "id": "r1FTWribf",
          "label": "control-change poly",
          "position": {
            "x": 612,
            "y": 204
          },
          "type": "@/control-change"
        },
        "rkpjlBs-z": {
          "id": "rkpjlBs-z",
          "label": "bank",
          "position": {
            "x": 34,
            "y": 102
          },
          "type": "xod/core/constant-number"
        },
        "rynuWBs-z": {
          "boundValues": {
            "BJ3-BVjWG": 126
          },
          "id": "rynuWBs-z",
          "label": "control-change mono",
          "position": {
            "x": 476,
            "y": 204
          },
          "type": "@/control-change"
        }
      },
      "path": "@/example-control-change"
    },
    "@/example-program-change": {
      "comments": {
        "HkLUmUi-f": {
          "content": "Every 20 seconds\nProgram change 5,\nThen after 5 seconds, \nBank Select 101/006 with Program Change 11",
          "id": "HkLUmUi-f",
          "position": {
            "x": 0,
            "y": 0
          },
          "size": {
            "height": 153,
            "width": 340
          }
        }
      },
      "links": {
        "B1vH7IsbM": {
          "id": "B1vH7IsbM",
          "input": {
            "nodeId": "ryDdZIjWG",
            "pinKey": "HyVupSsWf"
          },
          "output": {
            "nodeId": "BJwmm8jbz",
            "pinKey": "HJU8CE2lW"
          }
        },
        "SkX3WIjWz": {
          "id": "SkX3WIjWz",
          "input": {
            "nodeId": "S1AcWIjbz",
            "pinKey": "SkSuD6LMb"
          },
          "output": {
            "nodeId": "ryDdZIjWG",
            "pinKey": "rkKOlIsWf"
          }
        },
        "SkwhZUj-f": {
          "id": "SkwhZUj-f",
          "input": {
            "nodeId": "Bk5_WIi-G",
            "pinKey": "S1b7CHjbf"
          },
          "output": {
            "nodeId": "S1AcWIjbz",
            "pinKey": "Bk4gU0drwJ-"
          }
        },
        "Sy6zz8s-G": {
          "id": "Sy6zz8s-G",
          "input": {
            "nodeId": "Bk5_WIi-G",
            "pinKey": "Skw_AHi-M"
          },
          "output": {
            "nodeId": "rkKfzLi-z",
            "pinKey": "B1x2RV3eZ"
          }
        },
        "rk2TzUsWG": {
          "id": "rk2TzUsWG",
          "input": {
            "nodeId": "Bk5_WIi-G",
            "pinKey": "Bk89CrsbG"
          },
          "output": {
            "nodeId": "rkf8z8j-M",
            "pinKey": "B1x2RV3eZ"
          }
        },
        "rku1Q8sWf": {
          "id": "rku1Q8sWf",
          "input": {
            "nodeId": "Bk5_WIi-G",
            "pinKey": "BJveJLiZG"
          },
          "output": {
            "nodeId": "S1U1QIiWz",
            "pinKey": "B1x2RV3eZ"
          }
        }
      },
      "nodes": {
        "BJwmm8jbz": {
          "boundValues": {
            "B13SCNhl-": 20
          },
          "id": "BJwmm8jbz",
          "label": "clock 20sec",
          "position": {
            "x": 204,
            "y": 102
          },
          "type": "xod/core/clock"
        },
        "Bk5_WIi-G": {
          "id": "Bk5_WIi-G",
          "position": {
            "x": 68,
            "y": 510
          },
          "type": "@/bank-program-change"
        },
        "S1AcWIjbz": {
          "boundValues": {
            "Skre8ROSv1-": 5
          },
          "id": "S1AcWIjbz",
          "label": "delay 5",
          "position": {
            "x": 204,
            "y": 306
          },
          "type": "xod/core/delay"
        },
        "S1U1QIiWz": {
          "boundValues": {
            "B1x2RV3eZ": 11
          },
          "id": "S1U1QIiWz",
          "label": "11",
          "position": {
            "x": 68,
            "y": 408
          },
          "type": "xod/core/constant-number"
        },
        "rkKfzLi-z": {
          "boundValues": {
            "B1x2RV3eZ": 101
          },
          "id": "rkKfzLi-z",
          "label": "101",
          "position": {
            "x": 102,
            "y": 408
          },
          "type": "xod/core/constant-number"
        },
        "rkf8z8j-M": {
          "boundValues": {
            "B1x2RV3eZ": 6
          },
          "id": "rkf8z8j-M",
          "label": "006",
          "position": {
            "x": 136,
            "y": 408
          },
          "type": "xod/core/constant-number"
        },
        "ryDdZIjWG": {
          "boundValues": {
            "HJT7tBobG": 5
          },
          "id": "ryDdZIjWG",
          "position": {
            "x": 204,
            "y": 204
          },
          "type": "@/program-change"
        }
      },
      "path": "@/example-program-change"
    },
    "@/note": {
      "attachments": [
        {
          "content": "{{#global}}\n#include <MIDI.h>\nnamespace xod {\nnamespace awgrover__midi {\n  #ifndef MIDI47_DEFAULT_INSTANCE\n    // create one 'MIDI' object only once\n    #define MIDI47_DEFAULT_INSTANCE\n    bool MIDI_DefaultInited=0; // control setup once\n\n    MIDI_CREATE_DEFAULT_INSTANCE(); // MIDI\n\n    #define DEBUG_SendText(body) /* nothing, see the \"debug\" node */\n\n    void midi_setup() {\n      // this should be in setup\n      // ( call as xod::awgrover__midi::midi_setup(); in evaluate)\n      if (!MIDI_DefaultInited) {\n        // this will reset the serial port to 31250 for the midi's serial port\n        MIDI.begin(MIDI_CHANNEL_OMNI); // Enable Soft Thru, everything at the input is sent back\n        MIDI_DefaultInited = 1;\n        DEBUG_SendText( Serial.print(millis());Serial.print(F(\" MIDI.begin()\")); )\n      }\n    }\n  #endif\n}}\n{{/global}}\n\nstruct State {\n};\n\n{{ GENERATED_CODE }}\n\nvoid evaluate(Context ctx) {\n    xod::awgrover__midi::midi_setup(); \n    \n    auto channel = getValue<input_Ch>(ctx);\n    auto note = getValue<input_Num>(ctx);\n    \n    if (isInputDirty<input_play>(ctx)) {\n        auto on_velocity = getValue<input_VelOn>(ctx);\n    \t// note, velocity, channel\n    \txod::awgrover__midi::MIDI.sendNoteOn(note, on_velocity, channel);\n      // only if xod \"Debugger\" is on\n      DEBUG_SendText(\n        Serial.print(millis());Serial.print(F(\" \"));\n        Serial.print(F(\"Sent midi-note \"));Serial.print(note);\n        Serial.print(F(\"Vel \"));Serial.println(on_velocity);\t\n      )\n    }\n    else if (isInputDirty<input_stop>(ctx)) {\n        auto off_velocity = getValue<input_VelOff>(ctx);\n    \t// note, velocity, channel\n    \txod::awgrover__midi::MIDI.sendNoteOff(note, off_velocity, channel);\n      // only if xod \"Debugger\" is on\n      DEBUG_SendText(\n        Serial.print(millis());Serial.print(F(\" \"));\n        Serial.print(F(\"Sent midi-note \"));Serial.print(note);\n        Serial.print(F(\"Vel \"));Serial.print(off_velocity);\n        Serial.println(F(\" off\"));\n      )\n    }\n\n}\n",
          "encoding": "utf8",
          "filename": "patch.cpp"
        }
      ],
      "description": "Start/stop a note.",
      "nodes": {
        "B1C_iV5xG": {
          "description": "Send NoteOff when triggered",
          "id": "B1C_iV5xG",
          "label": "stop",
          "position": {
            "x": 340,
            "y": 0
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "BJExOs4clz": {
          "description": "Send NoteOn when triggered",
          "id": "BJExOs4clz",
          "label": "play",
          "position": {
            "x": 272,
            "y": 0
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "BJxxujN9xf": {
          "boundValues": {
            "__out__": 64
          },
          "description": "Velocity Level (on). often volume, depends on the instrument",
          "id": "BJxxujN9xf",
          "label": "VelOn",
          "position": {
            "x": 136,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "HJGluiEqeM": {
          "description": "some instruments respond to off-velocity, or have decay. Normally 0",
          "id": "HJGluiEqeM",
          "label": "VelOff",
          "position": {
            "x": 204,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "HkSedjNqgM": {
          "id": "HkSedjNqgM",
          "position": {
            "x": 135,
            "y": 101
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        },
        "S1mldsE5lz": {
          "boundValues": {
            "__out__": 1
          },
          "description": "MIDI Channel",
          "id": "S1mldsE5lz",
          "label": "Ch",
          "position": {
            "x": 68,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "SyluoNqlG": {
          "boundValues": {
            "__out__": 60
          },
          "description": "Note number",
          "id": "SyluoNqlG",
          "label": "Num",
          "position": {
            "x": -1,
            "y": -1
          },
          "type": "xod/patch-nodes/input-number"
        }
      },
      "path": "@/note"
    },
    "@/note-button": {
      "comments": {
        "HkaOAM9bz": {
          "content": "xod button has a 20msec latency",
          "id": "HkaOAM9bz",
          "position": {
            "x": 102,
            "y": 102
          },
          "size": {
            "height": 51,
            "width": 136
          }
        }
      },
      "description": "A button starts the note (push) and stops on release. Uses xod/common-hardware/button",
      "links": {
        "B1TaaGqZf": {
          "id": "B1TaaGqZf",
          "input": {
            "nodeId": "BkRuaz5ZG",
            "pinKey": "H1v3lCu8-"
          },
          "output": {
            "nodeId": "HkCmhf9-M",
            "pinKey": "BJ--G1tI-"
          }
        },
        "BkNVa_TMG": {
          "id": "BkNVa_TMG",
          "input": {
            "nodeId": "rybQ6daMG",
            "pinKey": "BJxxujN9xf"
          },
          "output": {
            "nodeId": "HJWxd9CrZG",
            "pinKey": "__out__"
          }
        },
        "ByZE6d6MG": {
          "id": "ByZE6d6MG",
          "input": {
            "nodeId": "rybQ6daMG",
            "pinKey": "HJGluiEqeM"
          },
          "output": {
            "nodeId": "B1zxdqArbM",
            "pinKey": "__out__"
          }
        },
        "H1UEadaGM": {
          "id": "H1UEadaGM",
          "input": {
            "nodeId": "rybQ6daMG",
            "pinKey": "S1mldsE5lz"
          },
          "output": {
            "nodeId": "S17gOcAS-z",
            "pinKey": "__out__"
          }
        },
        "SyFETOazG": {
          "id": "SyFETOazG",
          "input": {
            "nodeId": "rybQ6daMG",
            "pinKey": "SyluoNqlG"
          },
          "output": {
            "nodeId": "SJ4eO9RSZG",
            "pinKey": "__out__"
          }
        },
        "SyG43M9WG": {
          "id": "SyG43M9WG",
          "input": {
            "nodeId": "HkCmhf9-M",
            "pinKey": "ByNiWkt8Z"
          },
          "output": {
            "nodeId": "B1_2cAr-z",
            "pinKey": "__out__"
          }
        },
        "SyGPRf5WG": {
          "id": "SyGPRf5WG",
          "input": {
            "nodeId": "BJHfRz9bM",
            "pinKey": "__in__"
          },
          "output": {
            "nodeId": "HkCmhf9-M",
            "pinKey": "BJ--G1tI-"
          }
        },
        "r1ir6dTzz": {
          "id": "r1ir6dTzz",
          "input": {
            "nodeId": "rybQ6daMG",
            "pinKey": "BJExOs4clz"
          },
          "output": {
            "nodeId": "BJHfRz9bM",
            "pinKey": "__out__"
          }
        },
        "rJdST_6ff": {
          "id": "rJdST_6ff",
          "input": {
            "nodeId": "rybQ6daMG",
            "pinKey": "B1C_iV5xG"
          },
          "output": {
            "nodeId": "BkRuaz5ZG",
            "pinKey": "BJxRgAO8-"
          }
        }
      },
      "nodes": {
        "B1_2cAr-z": {
          "boundValues": {
            "__out__": 10
          },
          "description": "pin for button",
          "id": "B1_2cAr-z",
          "label": "port",
          "position": {
            "x": 34,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "B1zxdqArbM": {
          "description": "some instruments respond to off-velocity, or have decay. Normally 0",
          "id": "B1zxdqArbM",
          "label": "VelOff",
          "position": {
            "x": 340,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "BJHfRz9bM": {
          "id": "BJHfRz9bM",
          "position": {
            "x": 34,
            "y": 204
          },
          "type": "xod/core/pulse-on-true"
        },
        "BkRuaz5ZG": {
          "id": "BkRuaz5ZG",
          "position": {
            "x": 68,
            "y": 204
          },
          "type": "xod/core/pulse-on-false"
        },
        "HJWxd9CrZG": {
          "boundValues": {
            "__out__": 64
          },
          "description": "Velocity Level (on). Often volume, depends on the instrument",
          "id": "HJWxd9CrZG",
          "label": "VelOn",
          "position": {
            "x": 272,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "HkCmhf9-M": {
          "id": "HkCmhf9-M",
          "position": {
            "x": 34,
            "y": 102
          },
          "type": "xod/common-hardware/button"
        },
        "S17gOcAS-z": {
          "boundValues": {
            "__out__": 1
          },
          "description": "MIDI Channel",
          "id": "S17gOcAS-z",
          "label": "Ch",
          "position": {
            "x": 204,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "SJ4eO9RSZG": {
          "boundValues": {
            "__out__": 60
          },
          "description": "Note Number",
          "id": "SJ4eO9RSZG",
          "label": "No.",
          "position": {
            "x": 136,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "rybQ6daMG": {
          "id": "rybQ6daMG",
          "position": {
            "x": 68,
            "y": 408
          },
          "type": "@/note"
        }
      },
      "path": "@/note-button"
    },
    "@/program-change": {
      "attachments": [
        {
          "content": "{{#global}}\n#include <MIDI.h>\nnamespace xod {\nnamespace awgrover__midi {\n  #ifndef MIDI47_DEFAULT_INSTANCE\n    // create one 'MIDI' object only once\n    #define MIDI47_DEFAULT_INSTANCE\n    bool MIDI_DefaultInited=0; // control setup once\n\n    MIDI_CREATE_DEFAULT_INSTANCE(); // MIDI\n\n    #define DEBUG_SendText(body) /* nothing, see the \"debug\" node */\n\n    void midi_setup() {\n      // this should be in setup\n      // ( call as xod::awgrover__midi::midi_setup(); in evaluate)\n      if (!MIDI_DefaultInited) {\n        // this will reset the serial port to 31250 for the midi's serial port\n        MIDI.begin(MIDI_CHANNEL_OMNI); // Enable Soft Thru, everything at the input is sent back\n        MIDI_DefaultInited = 1;\n        DEBUG_SendText( Serial.print(millis());Serial.print(F(\" MIDI.begin()\")); )\n      }\n    }\n  #endif\n}}\n{{/global}}\n\nstruct State {\n};\n\n{{ GENERATED_CODE }}\n\nvoid evaluate(Context ctx) {\n     xod::awgrover__midi::midi_setup();\n    \n    if (isInputDirty<input_send>(ctx)) {\n        auto channel = getValue<input_Ch>(ctx);\n        auto program_number = getValue<input_Ch>(ctx);\n      \txod::awgrover__midi::MIDI.sendProgramChange(program_number, channel);\n        emitValue<output_sent>(ctx,1);\n        // only if xod \"Debugger\" is on\n        DEBUG_SendText(\n          Serial.print(millis());Serial.print(F(\" \"));\n          Serial.print(F(\"Sent progchg/\"));Serial.println(channel);\n          Serial.print(F(\" \"));Serial.println(program_number);\n        )\n    }\n}\n",
          "encoding": "utf8",
          "filename": "patch.cpp"
        }
      ],
      "description": "Set the inputs, send on pulse (\"send\")",
      "nodes": {
        "HJT7tBobG": {
          "boundValues": {
            "__out__": 1
          },
          "description": "Program Change Number",
          "id": "HJT7tBobG",
          "label": "Prg",
          "position": {
            "x": 102,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "HyVupSsWf": {
          "description": "Send when triggered",
          "id": "HyVupSsWf",
          "label": "send",
          "position": {
            "x": 238,
            "y": 0
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "rJ5FtBoZG": {
          "boundValues": {
            "__out__": 1
          },
          "description": "MIDI Channel",
          "id": "rJ5FtBoZG",
          "label": "Ch",
          "position": {
            "x": 170,
            "y": 0
          },
          "type": "xod/patch-nodes/input-number"
        },
        "rkKOlIsWf": {
          "description": "Pulse when sent",
          "id": "rkKOlIsWf",
          "label": "sent",
          "position": {
            "x": 170,
            "y": 204
          },
          "type": "xod/patch-nodes/output-pulse"
        },
        "ryiRaHoZG": {
          "id": "ryiRaHoZG",
          "position": {
            "x": 170,
            "y": 102
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        }
      },
      "path": "@/program-change"
    }
  },
  "version": "1.3.3"
}
