{
  "patches": {
    "@/sdcard-log-example": {
      "description": "Use the SD-Card to store and retrieve data",
      "links": {
        "rk5Y0RxkF": {
          "id": "rk5Y0RxkF",
          "output": {
            "nodeId": "Hk2_0AekY",
            "pinKey": "HJU8CE2lW"
          },
          "input": {
            "nodeId": "HkPtCClkt",
            "pinKey": "HJAq-A_8-"
          }
        },
        "r1ZoACg1K": {
          "id": "r1ZoACg1K",
          "output": {
            "nodeId": "HkPtCClkt",
            "pinKey": "r1yhZRd8W"
          },
          "input": {
            "nodeId": "rJycAClJY",
            "pinKey": "HynENHNOz"
          }
        },
        "SkSn0CxJF": {
          "id": "SkSn0CxJF",
          "output": {
            "nodeId": "S1x3RRlyF",
            "pinKey": "BkEVI0uHwJb"
          },
          "input": {
            "nodeId": "rJycAClJY",
            "pinKey": "rJJHNrVuM"
          }
        },
        "S1cRRAgJF": {
          "id": "S1cRRAgJF",
          "output": {
            "nodeId": "Hk2_0AekY",
            "pinKey": "HJU8CE2lW"
          },
          "input": {
            "nodeId": "S1x3RRlyF",
            "pinKey": "Bk74I0_SPyb"
          }
        },
        "rJMeJeZ1F": {
          "id": "rJMeJeZ1F",
          "output": {
            "nodeId": "S10JJlW1F",
            "pinKey": "H1wh06BEV"
          },
          "input": {
            "nodeId": "rJycAClJY",
            "pinKey": "rJJHNrVuM-$2"
          }
        },
        "B1RiNxzyF": {
          "id": "B1RiNxzyF",
          "output": {
            "nodeId": "rJycAClJY",
            "pinKey": "HJrBNr4dG"
          },
          "input": {
            "nodeId": "rkHc20ZJF",
            "pinKey": "HkXK-dGob"
          }
        },
        "BkVfTgG1F": {
          "id": "BkVfTgG1F",
          "output": {
            "nodeId": "B1Zzg-WyK",
            "pinKey": "B1x2RV3eZ"
          },
          "input": {
            "nodeId": "BkJyalzkF",
            "pinKey": "rkGg5ngzJK"
          }
        },
        "Hktfpez1t": {
          "id": "Hktfpez1t",
          "output": {
            "nodeId": "BkR7kgM1F",
            "pinKey": "Bkf4BDsmV"
          },
          "input": {
            "nodeId": "BkJyalzkF",
            "pinKey": "rylg93gMyF"
          }
        },
        "rycR1bGJt": {
          "id": "rycR1bGJt",
          "output": {
            "nodeId": "rJycAClJY",
            "pinKey": "HJrBNr4dG"
          },
          "input": {
            "nodeId": "BkJyalzkF",
            "pinKey": "Bkbg93efJt"
          }
        },
        "HkUkmbG1F": {
          "id": "HkUkmbG1F",
          "output": {
            "nodeId": "B1Zzg-WyK",
            "pinKey": "B1x2RV3eZ"
          },
          "input": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "rkGg5ngzJK"
          }
        },
        "rkdyXWfkK": {
          "id": "rkdyXWfkK",
          "output": {
            "nodeId": "HyNl-JW1Y",
            "pinKey": "Bkf4BDsmV"
          },
          "input": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "rylg93gMyF"
          }
        },
        "BkcJXWMJK": {
          "id": "BkcJXWMJK",
          "output": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "B1aN1WzJF"
          },
          "input": {
            "nodeId": "Bk_kZbz1F",
            "pinKey": "HkXK-dGob"
          }
        },
        "SkRx_BXyY": {
          "id": "SkRx_BXyY",
          "output": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "Hy2VvBQkK"
          },
          "input": {
            "nodeId": "HJig_r71t",
            "pinKey": "HkXK-dGob"
          }
        },
        "S1ZElwQ1F": {
          "id": "S1ZElwQ1F",
          "output": {
            "nodeId": "BJimevmkF",
            "pinKey": "ByfGSDjQE"
          },
          "input": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "H1Wj0U7yt"
          }
        },
        "Hk7VeDmkK": {
          "id": "Hk7VeDmkK",
          "output": {
            "nodeId": "S1J4gw7kK",
            "pinKey": "ByfGSDjQE"
          },
          "input": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "ryroAU71F"
          }
        },
        "BJhIBwm1F": {
          "id": "BJhIBwm1F",
          "output": {
            "nodeId": "H1oUrwX1F",
            "pinKey": "H1wh06BEV"
          },
          "input": {
            "nodeId": "rJycAClJY",
            "pinKey": "rJJHNrVuM-$1"
          }
        },
        "BJxL9YV1F": {
          "id": "BJxL9YV1F",
          "output": {
            "nodeId": "B1hrcF4yt",
            "pinKey": "B1x2RV3eZ"
          },
          "input": {
            "nodeId": "BkJyalzkF",
            "pinKey": "rJxq2xGyY"
          }
        },
        "H1MIctVkt": {
          "id": "H1MIctVkt",
          "output": {
            "nodeId": "B1hrcF4yt",
            "pinKey": "B1x2RV3eZ"
          },
          "input": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "rJxq2xGyY"
          }
        },
        "BkrK2tEkF": {
          "id": "BkrK2tEkF",
          "output": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "B1aN1WzJF"
          },
          "input": {
            "nodeId": "Bk9unK41Y",
            "pinKey": "HJdO9HwJ-"
          }
        },
        "S1KK2t4kK": {
          "id": "S1KK2t4kK",
          "output": {
            "nodeId": "HkMJ7ZzJF",
            "pinKey": "Sycinlz1Y"
          },
          "input": {
            "nodeId": "Bk9unK41Y",
            "pinKey": "S1n95SDJb"
          }
        }
      },
      "nodes": {
        "Hk2_0AekY": {
          "id": "Hk2_0AekY",
          "type": "xod/core/clock",
          "position": {
            "x": -4,
            "y": -1,
            "units": "slots"
          }
        },
        "HkPtCClkt": {
          "id": "HkPtCClkt",
          "type": "xod/core/count",
          "position": {
            "x": -7,
            "y": 0,
            "units": "slots"
          }
        },
        "rJycAClJY": {
          "boundLiterals": {
            "rJGQNB4df": "\",\"",
            "rJJHNrVuM-$1": "\"Laugh\""
          },
          "arityLevel": 3,
          "id": "rJycAClJY",
          "type": "xod/core/join",
          "position": {
            "x": -5,
            "y": 1,
            "units": "slots"
          }
        },
        "S1x3RRlyF": {
          "id": "S1x3RRlyF",
          "type": "xod/core/system-time",
          "position": {
            "x": -3,
            "y": 0,
            "units": "slots"
          }
        },
        "HyNl-JW1Y": {
          "id": "HyNl-JW1Y",
          "type": "xod/debug/tweak-pulse",
          "position": {
            "x": -1,
            "y": 3,
            "units": "slots"
          }
        },
        "S10JJlW1F": {
          "boundLiterals": {
            "H1wh06BEV": "\"Bingo\""
          },
          "size": {
            "width": 3,
            "height": 1,
            "units": "slots"
          },
          "id": "S10JJlW1F",
          "type": "xod/debug/tweak-string-16",
          "position": {
            "x": 2,
            "y": 0,
            "units": "slots"
          }
        },
        "B1Zzg-WyK": {
          "boundLiterals": {
            "B1x2RV3eZ": "\"XODLOG.csv\""
          },
          "id": "B1Zzg-WyK",
          "type": "xod/core/constant-string",
          "position": {
            "x": -7,
            "y": 1,
            "units": "slots"
          }
        },
        "rkHc20ZJF": {
          "size": {
            "width": 9,
            "height": 1,
            "units": "slots"
          },
          "id": "rkHc20ZJF",
          "position": {
            "x": 0,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/debug/watch"
        },
        "BkR7kgM1F": {
          "id": "BkR7kgM1F",
          "type": "xod/debug/tweak-pulse",
          "position": {
            "x": -2,
            "y": 2,
            "units": "slots"
          }
        },
        "BkJyalzkF": {
          "boundLiterals": {
            "rJxq2xGyY": "D53"
          },
          "id": "BkJyalzkF",
          "type": "@/sd-append",
          "position": {
            "x": -7,
            "y": 2,
            "units": "slots"
          }
        },
        "Bk_kZbz1F": {
          "size": {
            "width": 25,
            "height": 1,
            "units": "slots"
          },
          "id": "Bk_kZbz1F",
          "position": {
            "x": -5,
            "y": 4,
            "units": "slots"
          },
          "type": "xod/debug/watch"
        },
        "HkMJ7ZzJF": {
          "boundLiterals": {
            "HJ-qEUm1F": "20"
          },
          "id": "HkMJ7ZzJF",
          "type": "@/sd-read",
          "position": {
            "x": -6,
            "y": 3,
            "units": "slots"
          }
        },
        "HJig_r71t": {
          "size": {
            "width": 3,
            "height": 1,
            "units": "slots"
          },
          "id": "HJig_r71t",
          "position": {
            "x": 1,
            "y": 3,
            "units": "slots"
          },
          "type": "xod/debug/watch"
        },
        "BJimevmkF": {
          "boundLiterals": {
            "ByfGSDjQE": "0"
          },
          "id": "BJimevmkF",
          "type": "xod/debug/tweak-number",
          "position": {
            "x": -8,
            "y": 3,
            "units": "slots"
          }
        },
        "S1J4gw7kK": {
          "boundLiterals": {
            "ByfGSDjQE": "12"
          },
          "id": "S1J4gw7kK",
          "type": "xod/debug/tweak-number",
          "position": {
            "x": -7,
            "y": 3,
            "units": "slots"
          }
        },
        "H1oUrwX1F": {
          "boundLiterals": {
            "H1wh06BEV": "\"tweak\""
          },
          "size": {
            "width": 2,
            "height": 1,
            "units": "slots"
          },
          "id": "H1oUrwX1F",
          "type": "xod/debug/tweak-string-16",
          "position": {
            "x": -1,
            "y": 0,
            "units": "slots"
          }
        },
        "B1hrcF4yt": {
          "boundLiterals": {
            "B1x2RV3eZ": "D64"
          },
          "description": "Use D64 for SD-Card on WIO-Terminal",
          "id": "B1hrcF4yt",
          "type": "xod/core/constant-port",
          "position": {
            "x": -8,
            "y": 2,
            "units": "slots"
          }
        },
        "Bk9unK41Y": {
          "id": "Bk9unK41Y",
          "type": "xod/debug/console-log",
          "position": {
            "x": -9,
            "y": 4,
            "units": "slots"
          }
        }
      },
      "path": "@/sdcard-log-example"
    },
    "@/sd-read": {
      "attachments": [
        {
          "filename": "patch.cpp",
          "encoding": "utf-8",
          "content": "// This is the old sd-log patch migrated to the new v0.35 syntax method according to https://xod.io/docs/guide/migrating-to-v035/\n\n#pragma XOD evaluate_on_pin disable\n#pragma XOD evaluate_on_pin enable input_R\n#pragma XOD error_raise enable\n\n\n\n#include <SPI.h>\n#include <SD.h>\nsize_t strlcpy(char *dst, const char *src, size_t size)\n// Thanks to Adam Rosenfield for this funcion, strlcpy\n{\n    size_t len = 0;\n    while(size > 1 && *src)\n    {\n        *dst++ = *src++;\n        size--;\n        len++;\n    }\n    if(size > 0)\n        *dst = 0;\n    return len + strlen(src);    \n}\n\n\nnode {\n    \n    bool begun;\n    char str[64] ;\n \n    CStringView view = CStringView(str);\n    \nvoid evaluate(Context ctx) {\n    if (!isInputDirty<input_R>(ctx))\n        return;\n\n\n    if (!begun) {\n        // First time use, initialize\n        auto csPin = getValue<input_CS>(ctx);\n        begun = SD.begin(csPin);\n    }\n\n    if (!begun) {\n        // Initialization failed (wrong connection, no SD card)\n        raiseError(ctx);\n        return;\n    }\n    char filename[16] = { 0 };\n    dump(getValue<input_FILE>(ctx), filename);\n    File myFile = SD.open(filename, O_READ);\n    if (!myFile) {\n        // Failed to open the file. Maybe, SD card gone,\n        // try to reinit next time\n        begun = false;\n        raiseError(ctx); // Can't open file\n        return;\n    }\n\n    uint8_t START = getValue<input_START>(ctx);\n    uint8_t CAP = getValue<input_CAP>(ctx);\n    \n    myFile.seek(START);\n\n    uint8_t index = 0;\n    //char ch[CAP+1];\n   while (myFile.available() && index < CAP){\n       char someChar = myFile.read();\n      \n       str[index] =someChar;\n     \n        index++;\n       str[index] = '\\0';\n   }\n  \n    int pos = myFile.position();\n    \n    //strlcpy(str, ch, sizeof(str));\n    \n    myFile.close();\n    \n   emitValue<output_STR>(ctx, XString(&view));\n   emitValue<output_DONE>(ctx, 1);\n   emitValue<output_POS>(ctx, pos);\n\n\n}\n}\n\n"
        }
      ],
      "description": "Read data from a file on the SD-Card\n",
      "nodes": {
        "S1d1hgGkK": {
          "id": "S1d1hgGkK",
          "type": "xod/patch-nodes/not-implemented-in-xod",
          "position": {
            "x": 2,
            "y": 1,
            "units": "slots"
          }
        },
        "rJxq2xGyY": {
          "boundLiterals": {
            "__out__": "D53"
          },
          "description": "CS (chip select) pin the SD card reader is connected to. Also known as SS (slave select).",
          "label": "CS",
          "id": "rJxq2xGyY",
          "position": {
            "x": 1,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-port"
        },
        "rylg93gMyF": {
          "description": "Perform file open, read, close cycle",
          "label": "R",
          "id": "rylg93gMyF",
          "position": {
            "x": 5,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "rkGg5ngzJK": {
          "description": "File name to append to",
          "label": "FILE",
          "id": "rkGg5ngzJK",
          "position": {
            "x": 2,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-string"
        },
        "Sycinlz1Y": {
          "description": "Fires when write is done",
          "label": "DONE",
          "id": "Sycinlz1Y",
          "position": {
            "x": 2,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/patch-nodes/output-pulse"
        },
        "B1aN1WzJF": {
          "label": "STR",
          "id": "B1aN1WzJF",
          "type": "xod/patch-nodes/output-string",
          "position": {
            "x": 4,
            "y": 2,
            "units": "slots"
          }
        },
        "Hy2VvBQkK": {
          "label": "POS",
          "id": "Hy2VvBQkK",
          "type": "xod/patch-nodes/output-number",
          "position": {
            "x": 6,
            "y": 2,
            "units": "slots"
          }
        },
        "H1Wj0U7yt": {
          "label": "START",
          "id": "H1Wj0U7yt",
          "type": "xod/patch-nodes/input-number",
          "position": {
            "x": 3,
            "y": 0,
            "units": "slots"
          }
        },
        "ryroAU71F": {
          "label": "CAP",
          "id": "ryroAU71F",
          "type": "xod/patch-nodes/input-number",
          "position": {
            "x": 4,
            "y": 0,
            "units": "slots"
          }
        }
      },
      "path": "@/sd-read"
    },
    "@/sd-append": {
      "attachments": [
        {
          "filename": "patch.cpp",
          "encoding": "utf-8",
          "content": "// This is the old sd-log patch migrated to the new v0.35 syntax method according to https://xod.io/docs/guide/migrating-to-v035/\n\n#pragma XOD evaluate_on_pin disable\n#pragma XOD evaluate_on_pin enable input_A\n#pragma XOD error_raise enable\n\n//{{#global}}\n#include <SPI.h>\n#include <SD.h>\n//{{/global}}\n\n//struct State {\n//    bool begun;\n//};\n\n//{{ GENERATED_CODE }}\nnode {\n    \nbool begun;\n    \nvoid evaluate(Context ctx) {\n    if (!isInputDirty<input_A>(ctx))\n        return;\n\n    //auto state = getState(ctx);\n\n    if (!begun) {\n        // First time use, initialize\n        auto csPin = getValue<input_CS>(ctx);\n        begun = SD.begin(csPin);\n    }\n\n    if (!begun) {\n        // Initialization failed (wrong connection, no SD card)\n        raiseError(ctx);\n        return;\n    }\n\n    char filename[16] = { 0 };\n    dump(getValue<input_FILE>(ctx), filename);\n    File file = SD.open(filename, O_WRITE | O_CREAT | O_APPEND);\n    if (!file) {\n        // Failed to open the file. Maybe, SD card gone,\n        // try to reinit next time\n        begun = false;\n        raiseError(ctx); // Can't open file\n        return;\n    }\n\n    XString line = getValue<input_LINE>(ctx);\n    size_t lastWriteSize;\n    for (auto it = line.iterate(); it; ++it) {\n        lastWriteSize = file.print(*it);\n        if (lastWriteSize == 0) {\n            begun = false;\n            raiseError(ctx); // No bytes written\n            return;\n        }\n    }\n\n    file.print('\\n');\n    file.flush();\n    file.close();\n    emitValue<output_DONE>(ctx, 1);\n}\n}\n\n"
        }
      ],
      "description": "Append data to a file on the SD-Card. Will create the file if it does not exist.",
      "nodes": {
        "S1d1hgGkK": {
          "id": "S1d1hgGkK",
          "type": "xod/patch-nodes/not-implemented-in-xod",
          "position": {
            "x": 2,
            "y": 1,
            "units": "slots"
          }
        },
        "rJxq2xGyY": {
          "boundLiterals": {
            "__out__": "D53"
          },
          "description": "CS (chip select) pin the SD card reader is connected to. Also known as SS (slave select).",
          "label": "CS",
          "id": "rJxq2xGyY",
          "position": {
            "x": 1,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-port"
        },
        "rylg93gMyF": {
          "description": "Perform file open, write, flush, close cycle",
          "label": "A",
          "id": "rylg93gMyF",
          "position": {
            "x": 4,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "Bkbg93efJt": {
          "description": "Line to append",
          "label": "LINE",
          "id": "Bkbg93efJt",
          "position": {
            "x": 3,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-string"
        },
        "rkGg5ngzJK": {
          "description": "File name to append to",
          "label": "FILE",
          "id": "rkGg5ngzJK",
          "position": {
            "x": 2,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-string"
        },
        "Sycinlz1Y": {
          "description": "Fires when write is done",
          "label": "DONE",
          "id": "Sycinlz1Y",
          "position": {
            "x": 2,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/patch-nodes/output-pulse"
        }
      },
      "path": "@/sd-append"
    },
    "@/sd-write": {
      "attachments": [
        {
          "filename": "patch.cpp",
          "encoding": "utf-8",
          "content": "// This is the old sd-log patch migrated to the new v0.35 syntax method according to https://xod.io/docs/guide/migrating-to-v035/\n\n#pragma XOD evaluate_on_pin disable\n#pragma XOD evaluate_on_pin enable input_W\n#pragma XOD error_raise enable\n\n//{{#global}}\n#include <SPI.h>\n#include <SD.h>\n//{{/global}}\n\n//struct State {\n//    bool begun;\n//};\n\n//{{ GENERATED_CODE }}\nnode {\n    \nbool begun;\n    \nvoid evaluate(Context ctx) {\n    if (!isInputDirty<input_W>(ctx))\n        return;\n\n    //auto state = getState(ctx);\n\n    if (!begun) {\n        // First time use, initialize\n        auto csPin = getValue<input_CS>(ctx);\n        begun = SD.begin(csPin);\n    }\n\n    if (!begun) {\n        // Initialization failed (wrong connection, no SD card)\n        raiseError(ctx);\n        return;\n    }\n\n    char filename[16] = { 0 };\n    dump(getValue<input_FILE>(ctx), filename);\n    File file = SD.open(filename, O_WRITE | O_CREAT);\n    if (!file) {\n        // Failed to open the file. Maybe, SD card gone,\n        // try to reinit next time\n        begun = false;\n        raiseError(ctx); // Can't open file\n        return;\n    }\n\n    XString line = getValue<input_LINE>(ctx);\n    size_t lastWriteSize;\n    for (auto it = line.iterate(); it; ++it) {\n        lastWriteSize = file.print(*it);\n        if (lastWriteSize == 0) {\n            begun = false;\n            raiseError(ctx); // No bytes written\n            return;\n        }\n    }\n\n    file.print('\\n');\n    file.flush();\n    file.close();\n    emitValue<output_DONE>(ctx, 1);\n}\n}\n\n"
        }
      ],
      "description": "Log data to a file on the SD-Card",
      "nodes": {
        "S1d1hgGkK": {
          "description": "Write data to a file on the SD-Card. Will create the file if it does not exist.",
          "id": "S1d1hgGkK",
          "type": "xod/patch-nodes/not-implemented-in-xod",
          "position": {
            "x": 2,
            "y": 1,
            "units": "slots"
          }
        },
        "rJxq2xGyY": {
          "boundLiterals": {
            "__out__": "D53"
          },
          "description": "CS (chip select) pin the SD card reader is connected to. Also known as SS (slave select).",
          "label": "CS",
          "id": "rJxq2xGyY",
          "position": {
            "x": 1,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-port"
        },
        "rylg93gMyF": {
          "description": "Perform file open, write, flush, close cycle",
          "label": "W",
          "id": "rylg93gMyF",
          "position": {
            "x": 4,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "Bkbg93efJt": {
          "description": "Line to append",
          "label": "LINE",
          "id": "Bkbg93efJt",
          "position": {
            "x": 3,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-string"
        },
        "rkGg5ngzJK": {
          "description": "File name to append to",
          "label": "FILE",
          "id": "rkGg5ngzJK",
          "position": {
            "x": 2,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-string"
        },
        "Sycinlz1Y": {
          "description": "Fires when write is done",
          "label": "DONE",
          "id": "Sycinlz1Y",
          "position": {
            "x": 2,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/patch-nodes/output-pulse"
        }
      },
      "path": "@/sd-write"
    }
  },
  "license": "GPL",
  "version": "1.0.6",
  "description": "Use the SD-Card to store and retrieve data",
  "apiKey": "10dd4352-8ce8-43e8-8535-36c2d4f4dcc7",
  "name": "sd-card"
}
