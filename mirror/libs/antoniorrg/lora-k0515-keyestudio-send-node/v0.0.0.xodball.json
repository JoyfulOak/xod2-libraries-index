{
  "apiKey": "4b942123-c9d4-44a1-ba30-f0b971f052d3",
  "description": "Node to send data using a Lora KS0515 Keyestudio LoRa Wireless Expansion Board RFM69HCW 868mhz",
  "name": "lora-k0515-keyestudio-send-node",
  "patches": {
    "@/lora-send-message": {
      "attachments": [
        {
          "content": "#pragma XOD require \"https://github.com/adafruit/RadioHead\"\n#pragma XOD require \"https://github.com/nandland/spi-master\"\n#pragma XOD require \"https://github.com/LowPowerLab/RFM69\"\n\n\n#include <SPI.h>\n#include <RH_RF69.h>\n#include <RHReliableDatagram.h>\n\nint RFM69_INT = 2;   \nint RFM69_RST = 3;\nint RFM69_CS = 10;\nint RF69_FREQ = 343;\nint DEST_ADDRESS = 1;\nint MY_ADDRESS = 2;\n\n  RH_RF69 rf69(RFM69_CS, RFM69_INT);\n  RHReliableDatagram rf69_manager(rf69, MY_ADDRESS);\n\nnode {\n    // Internal state variables defined at this level persists across evaluations\n\n    Number foo;\n    uint8_t bar = 5;\n    \n    void evaluate(Context ctx) {\n        bar += 42;\n        if (isSettingUp()) {\n            // This run once\n            foo = (Number)(bar + 1);\n        }\n        \n    Number foo;\n    uint8_t bar = 5;\n    \n       if (!isInputDirty<input_UPD>(ctx))\n       return;\n\n        \n  digitalWrite(RFM69_RST, HIGH);\n  delay(10);\n  digitalWrite(RFM69_RST, LOW);\n  delay(10);\n\nNumber RF69_FREQ;\nchar radiopacket [20];\nint Power;\nint DEST_ADDRESS;\nint Received;\nint Message;\n       \nMessage = getValue<input_Message>(ctx);\nitoa(Message, radiopacket, 10);\n        \n  RF69_FREQ = getValue<input_RF69_FREQ>(ctx);\n  DEST_ADDRESS = getValue<input_DEST_ADDRESS>(ctx);\n  Power = getValue<input_Power>(ctx);\n        \n  ::pinMode(RFM69_RST, OUTPUT);\n  ::digitalWrite(RFM69_RST, 0);\n\n  rf69_manager.init();\n  rf69.setFrequency(RF69_FREQ);\n        \n//Manual reset\n  ::digitalWrite(RFM69_RST, 1);\n    delay (10);\n  ::digitalWrite(RFM69_RST, 0);\n    delay (10);\n        \n  rf69.setTxPower(20, true);  // range from 14-20 for power, 2nd arg must be true for 69HCW\n        \n  // The encryption key has to be the same as the one in the server\n  uint8_t key[] = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,\n                    0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08};\n  rf69.setEncryptionKey(key);\n\n// Dont put this on the stack:\nuint8_t buf[RH_RF69_MAX_MESSAGE_LEN];\ndelay (1000);\n\nif (rf69_manager.sendtoWait((uint8_t *)radiopacket, strlen(radiopacket), DEST_ADDRESS)) {\n    // Now wait for a reply from the server\n    uint8_t len = sizeof(buf);\n    uint8_t from;   \n      if (rf69_manager.recvfromAckTimeout(buf, &len, 2000, &from)) {\n      buf[len] = 0; // zero out remaining string\n      Received = atoi((const char*) buf);\n      emitValue<output_Received>(ctx, Received);\n    } \n  } \n\nradiopacket [0] = '\\0';\nemitValue<output_DONE>(ctx, 1);\n}\n}",
          "encoding": "utf-8",
          "filename": "patch.cpp"
        }
      ],
      "nodes": {
        "H1E0NIPFP": {
          "description": "If the receiver device sends a message, it will be displayed here",
          "id": "H1E0NIPFP",
          "label": "Received",
          "position": {
            "x": 13,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/patch-nodes/output-number"
        },
        "H1qBGIDYP": {
          "boundLiterals": {
            "__out__": "1"
          },
          "description": "Address of the receiver Lora",
          "id": "H1qBGIDYP",
          "label": "DEST_ADDRESS",
          "position": {
            "x": 13,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-number"
        },
        "S1Xy4jaOw": {
          "id": "S1Xy4jaOw",
          "position": {
            "x": 13,
            "y": 1,
            "units": "slots"
          },
          "type": "xod/patch-nodes/not-implemented-in-xod"
        },
        "S1cgCQgFP": {
          "boundLiterals": {
            "__out__": "Continuously"
          },
          "description": "Pin to update the node",
          "id": "S1cgCQgFP",
          "label": "UPD",
          "position": {
            "x": 18,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-pulse"
        },
        "SytHfUDYv": {
          "boundLiterals": {
            "__out__": "20"
          },
          "description": "Power for the communications. Higher power allows a long-range communication, but consumes more energy.",
          "id": "SytHfUDYv",
          "label": "Power",
          "position": {
            "x": 15,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-number"
        },
        "r1vTUxyFv": {
          "boundLiterals": {
            "__out__": "20"
          },
          "description": "Message to be sent",
          "id": "r1vTUxyFv",
          "label": "Message",
          "position": {
            "x": 16,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-number"
        },
        "rJIWyl1Fw": {
          "boundLiterals": {
            "__out__": "434.0"
          },
          "description": "Frequency used for the communications (must be the same a the frequency on the receiver end)",
          "id": "rJIWyl1Fw",
          "label": "RF69_FREQ",
          "position": {
            "x": 12,
            "y": 0,
            "units": "slots"
          },
          "type": "xod/patch-nodes/input-number"
        },
        "rkqWsc-FD": {
          "description": "Pulses 1 once the node has been executed",
          "id": "rkqWsc-FD",
          "label": "DONE",
          "position": {
            "x": 14,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/patch-nodes/output-pulse"
        }
      },
      "path": "@/lora-send-message"
    },
    "@/example": {
      "links": {
        "BkKpMLPtw": {
          "id": "BkKpMLPtw",
          "input": {
            "nodeId": "r1y7TTeYv",
            "pinKey": "r1vTUxyFv"
          },
          "output": {
            "nodeId": "ByBAfoGtw",
            "pinKey": "H1sM2A12-"
          }
        }
      },
      "nodes": {
        "ByBAfoGtw": {
          "boundLiterals": {
            "Hkry2AJhW": "A0"
          },
          "id": "ByBAfoGtw",
          "position": {
            "x": 17,
            "y": 2,
            "units": "slots"
          },
          "type": "xod/common-hardware/pot"
        },
        "r1y7TTeYv": {
          "boundLiterals": {
            "H18sc9WFD": "11",
            "H1qBGIDYP": "1",
            "S1cgCQgFP": "Continuously",
            "rJQgw1bKw": "333",
            "rkB3f1btD": "\"Send this\""
          },
          "id": "r1y7TTeYv",
          "position": {
            "x": 14,
            "y": 3,
            "units": "slots"
          },
          "type": "@/lora-send-message"
        }
      },
      "path": "@/example"
    }
  }
}
