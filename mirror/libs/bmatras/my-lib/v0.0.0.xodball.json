{
  "patches": {
    "@/main": {
      "path": "@/main"
    },
    "@/my-custom-code": {
      "nodes": {
        "SJX9uLgTgx": {
          "id": "SJX9uLgTgx",
          "type": "xod/patch-nodes/not-implemented-in-xod",
          "position": {
            "x": 9,
            "y": 1,
            "units": "slots"
          }
        },
        "rJvZiIe6lg": {
          "id": "rJvZiIe6lg",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 1,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY0"
        },
        "r1-roLlTel": {
          "id": "r1-roLlTel",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 2,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY1"
        },
        "ryNBoUeTlg": {
          "id": "ryNBoUeTlg",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 3,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY2"
        },
        "Hyx4HsUgael": {
          "id": "Hyx4HsUgael",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 4,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY3"
        },
        "H1-VSs8e6el": {
          "id": "H1-VSs8e6el",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 5,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY4"
        },
        "HJBHs8gaex": {
          "id": "HJBHs8gaex",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 6,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY5"
        },
        "r1gSSi8eTee": {
          "id": "r1gSSi8eTee",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 7,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY6"
        },
        "r1ZHBj8eplg": {
          "id": "r1ZHBj8eplg",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 8,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY7"
        },
        "ByMHSoLlpeg": {
          "id": "ByMHSoLlpeg",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 9,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY8"
        },
        "SJmHrj8gpgx": {
          "id": "SJmHrj8gpgx",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 10,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY9"
        },
        "S1UHsUeTxg": {
          "id": "S1UHsUeTxg",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 11,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY10"
        },
        "BJgUSi8eale": {
          "id": "BJgUSi8eale",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 12,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY11"
        },
        "HyvSiIlpgx": {
          "id": "HyvSiIlpgx",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 13,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY12"
        },
        "BylwBjLlpll": {
          "id": "BylwBjLlpll",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 14,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY13"
        },
        "Hy-DSiIgTel": {
          "id": "Hy-DSiIgTel",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 15,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY14"
        },
        "H1MwBoLxpex": {
          "id": "H1MwBoLxpex",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 16,
            "y": 0,
            "units": "slots"
          },
          "label": "RELAY15"
        },
        "SyeS2Ll6le": {
          "id": "SyeS2Ll6le",
          "type": "xod/patch-nodes/input-number",
          "position": {
            "x": 2,
            "y": -1,
            "units": "slots"
          },
          "label": "cs"
        },
        "Bkv83Lgale": {
          "id": "Bkv83Lgale",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 3,
            "y": -1,
            "units": "slots"
          },
          "label": "A0"
        },
        "B1ethLlpgg": {
          "id": "B1ethLlpgg",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 4,
            "y": -1,
            "units": "slots"
          },
          "label": "A1"
        },
        "HkzFnLe6xl": {
          "id": "HkzFnLe6xl",
          "type": "xod/patch-nodes/input-boolean",
          "position": {
            "x": 5,
            "y": -1,
            "units": "slots"
          },
          "label": "A2"
        }
      },
      "path": "@/my-custom-code",
      "attachments": [
        {
          "filename": "patch.cpp",
          "encoding": "utf-8",
          "content": "#pragma XOD require \"SPI.h\"\n#pragma XOD require \"Adafruit_MCP23X17.h\"\n\n// Paramètres inspecteur pour SPI / MCP\ninput_number CS;    // Chip Select SPI\ninput_number A0;    // Adressage matériel MCP\ninput_number A1;\ninput_number A2;\ninput_number SCI;   // Clock SPI (optionnel)\ninput_number SI;    // MOSI\ninput_number SO;    // MISO (si nécessaire)\n\n// Commandes relais (16 sorties)\ninput_bool RELAY0;\ninput_bool RELAY1;\ninput_bool RELAY2;\ninput_bool RELAY3;\ninput_bool RELAY4;\ninput_bool RELAY5;\ninput_bool RELAY6;\ninput_bool RELAY7;\ninput_bool RELAY8;\ninput_bool RELAY9;\ninput_bool RELAY10;\ninput_bool RELAY11;\ninput_bool RELAY12;\ninput_bool RELAY13;\ninput_bool RELAY14;\ninput_bool RELAY15;\n\n// Documentation interne\n#pragma XOD doc \"Node unique pour piloter 16 relais via MCP23S17 SPI\"\n#pragma XOD doc \"Paramètres SPI et adresse matérielle configurables dans l’inspecteur\"\n#pragma XOD doc \"Chaque RELAYx est une entrée booléenne qui pilote la sortie correspondante\"\n\n// MCP object singleton\nstatic Adafruit_MCP23X17 mcp;\nstatic bool init_done = false;\n\nnode {\n    void evaluate(Context ctx) {\n        if (!init_done) {\n            SPI.begin();  // Initialisation SPI globale\n\n            // Calcul offset adresse\n            uint8_t addrOffset = (getValue<input_number>(ctx, A0) & 1)\n                               | ((getValue<input_number>(ctx, A1) & 1) << 1)\n                               | ((getValue<input_number>(ctx, A2) & 1) << 2);\n\n            // Initialisation MCP23S17 SPI\n            uint8_t cs = getValue<input_number>(ctx, CS);\n            if (!mcp.begin_SPI(cs + addrOffset)) {\n                // Gestion erreur : ici on pourrait renvoyer un warning\n            }\n\n            // Configure toutes les sorties en OUTPUT\n            for (int i = 0; i < 16; i++) {\n                mcp.pinMode(i, OUTPUT);\n            }\n\n            init_done = true;\n        }\n\n        // Écriture des relais\n        mcp.digitalWrite(0, getValue<input_bool>(ctx, RELAY0));\n        mcp.digitalWrite(1, getValue<input_bool>(ctx, RELAY1));\n        mcp.digitalWrite(2, getValue<input_bool>(ctx, RELAY2));\n        mcp.digitalWrite(3, getValue<input_bool>(ctx, RELAY3));\n        mcp.digitalWrite(4, getValue<input_bool>(ctx, RELAY4));\n        mcp.digitalWrite(5, getValue<input_bool>(ctx, RELAY5));\n        mcp.digitalWrite(6, getValue<input_bool>(ctx, RELAY6));\n        mcp.digitalWrite(7, getValue<input_bool>(ctx, RELAY7));\n        mcp.digitalWrite(8, getValue<input_bool>(ctx, RELAY8));\n        mcp.digitalWrite(9, getValue<input_bool>(ctx, RELAY9));\n        mcp.digitalWrite(10, getValue<input_bool>(ctx, RELAY10));\n        mcp.digitalWrite(11, getValue<input_bool>(ctx, RELAY11));\n        mcp.digitalWrite(12, getValue<input_bool>(ctx, RELAY12));\n        mcp.digitalWrite(13, getValue<input_bool>(ctx, RELAY13));\n        mcp.digitalWrite(14, getValue<input_bool>(ctx, RELAY14));\n        mcp.digitalWrite(15, getValue<input_bool>(ctx, RELAY15));\n    }\n}\n"
        }
      ]
    }
  },
  "name": "my-lib"
}
